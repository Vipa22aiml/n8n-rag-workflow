# ðŸ“‹ Complete Workflow Setup Guide\n\n## Detailed Implementation Steps\n\nThis guide provides step-by-step instructions for implementing the RAG workflow shown in the main screenshot.\n\n## Phase 1: Setup Phase (Red Box)\n\n### Database Tables Creation\n\nThe red box contains three crucial nodes that must be executed once during initial setup:\n\n1. **Create Documents Table**\n   ```sql\n   CREATE TABLE documents (\n     id SERIAL PRIMARY KEY,\n     content TEXT NOT NULL,\n     metadata JSONB,\n     created_at TIMESTAMP DEFAULT NOW()\n   );\n   ```\n\n2. **Create Metadata Table**\n   ```sql\n   CREATE TABLE metadata (\n     id SERIAL PRIMARY KEY,\n     document_id INTEGER REFERENCES documents(id),\n     filename VARCHAR(255),\n     file_type VARCHAR(50),\n     author VARCHAR(255),\n     created_at TIMESTAMP DEFAULT NOW()\n   );\n   ```\n\n3. **Create Document Rows Table**\n   ```sql\n   CREATE TABLE document_rows (\n     id SERIAL PRIMARY KEY,\n     document_id INTEGER REFERENCES documents(id),\n     content TEXT,\n     embedding VECTOR(768),\n     metadata JSONB\n   );\n   ```\n\n## Phase 2: Ingestion Pipeline (Blue Box)\n\n### File Processing Workflow\n\n1. **File Triggers**\n   - **File Created**: Monitors for new files in specified Google Drive folder\n   - **File Updated**: Handles file modifications\n   - **Loop Over Items**: Processes multiple files in batch\n\n2. **Content Extraction Switch Logic**\n   ```javascript\n   // Switch node logic for file type detection\n   const fileExtension = $node[\"File Created\"].json[\"name\"].split('.').pop().toLowerCase();\n   \n   switch(fileExtension) {\n     case 'pdf':\n       return 0; // Route to PDF processor\n     case 'xlsx':\n     case 'xls':\n       return 1; // Route to Excel processor\n     case 'csv':\n       return 2; // Route to CSV processor\n     case 'txt':\n     case 'docx':\n       return 3; // Route to text processor\n     default:\n       return 4; // Route to error handler\n   }\n   ```\n\n3. **Processing Nodes**\n   - **Extract PDF Text**: Converts PDF to plain text\n   - **Extract from Excel**: Reads Excel sheets and converts to text\n   - **Extract from CSV**: Processes CSV data\n   - **Extract Document Text**: Handles plain text files\n\n4. **Embedding Generation**\n   - Uses Google Gemini Embeddings\n   - Converts text chunks into 768-dimensional vectors\n   - Stores in Supabase vector database\n\n## Phase 3: RAG AI Agent (Yellow Box)\n\n### Chat Interface Components\n\n1. **Webhook Receiver**\n   - Receives user messages\n   - Validates input format\n   - Routes to AI agent\n\n2. **Postgres Chat Memory**\n   - Maintains conversation history\n   - Enables contextual follow-up questions\n   - Stores user sessions\n\n3. **RAG AI Agent**\n   - Processes user queries\n   - Searches vector database for relevant content\n   - Generates contextual responses using Google Gemini\n\n## Phase 4: Agent Tools (Green Box)\n\n### Vector Search Implementation\n\n1. **Supabase Vector Search**\n   - Semantic similarity search\n   - Returns most relevant document chunks\n   - Provides context for AI responses\n\n2. **Embedding Pipeline**\n   - Real-time query embedding\n   - Vector similarity computation\n   - Result ranking and filtering\n\n## Advanced Configuration\n\n### Environment Variables\n```bash\n# Google Cloud\nGOOGLE_CLOUD_PROJECT_ID=your_project_id\nGOOGLE_CLOUD_KEY_FILE=path_to_service_account.json\n\n# Supabase\nSUPABASE_URL=your_supabase_url\nSUPABASE_ANON_KEY=your_anon_key\nSUPABASE_SERVICE_KEY=your_service_key\n\n# n8n\nN8N_WEBHOOK_URL=your_webhook_url\n```\n\n### Performance Optimization\n\n1. **Batch Processing**\n   - Process multiple files simultaneously\n   - Implement queue management\n   - Add retry logic for failed uploads\n\n2. **Vector Search Optimization**\n   - Fine-tune similarity thresholds\n   - Implement result caching\n   - Add metadata filtering\n\n3. **Memory Management**\n   - Implement conversation cleanup\n   - Set session timeouts\n   - Optimize embedding storage\n\n## Troubleshooting Guide\n\n### Common Issues and Solutions\n\n1. **Files Not Processing**\n   - Check Google Drive permissions\n   - Verify webhook endpoints\n   - Review file format support\n\n2. **Empty AI Responses**\n   - Verify embedding generation\n   - Check vector database connections\n   - Review search parameters\n\n3. **Memory Issues**\n   - Check Postgres connections\n   - Verify session management\n   - Review conversation cleanup\n\n### Monitoring and Alerts\n\n1. **Execution Monitoring**\n   - Track workflow success rates\n   - Monitor processing times\n   - Alert on failures\n\n2. **Database Health**\n   - Monitor vector storage usage\n   - Track query performance\n   - Alert on connection issues\n\n3. **API Usage**\n   - Monitor Google API quotas\n   - Track embedding costs\n   - Alert on rate limits\n\n---\n\n**Next Steps**: After completing this setup, refer to the main README for use cases and customization options."